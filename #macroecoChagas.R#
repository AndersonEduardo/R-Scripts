##investigando determinantes da doenca de chagas em escala macroecologica##

library(raster)
library(rgdal)

mapaRiqueza = raster('/home/anderson/Documentos/Projetos/Barbeiros_Lucas/Mapas de riqueza/mapaRiquezaPresente.asc')
mapaRisco = raster('/home/anderson/Documentos/Projetos/Barbeiros_Lucas/Mapas de risco/mapaRiscoPresente.asc')
mapaHII = raster('/home/anderson/PosDoc/dados_ambientais/hii-s-america-geo-grid/res2-5/hii-2-5.asc')
estados = readOGR(dsn='/home/anderson/PosDoc/shapefiles/br_unidades_da_federacao/BRUFE250GC_SIR.shp',layer='BRUFE250GC_SIR')
vetorEst = estados$NM_ESTADO

tabRes=data.frame()

for (i in 1:length(vetorEst)){

    est_i = estados[estados$NM_ESTADO == vetorEst[i],]
    ##riqueza
    riqMed = mean(unlist(extract(mapaRiqueza,est_i,na.rm=TRUE)),na.rm=TRUE)
    riqSD = sd(unlist(extract(mapaRiqueza,est_i,na.rm=TRUE)),na.rm=TRUE)
    ##risco
    riscMed = mean(unlist(extract(mapaRisco,est_i,na.rm=TRUE)),na.rm=TRUE)
    riscSD = sd(unlist(extract(mapaRisco,est_i,na.rm=TRUE)),na.rm=TRUE)
    ##impacto humano
    hiiMed = mean(unlist(extract(mapaHII,est_i,na.rm=TRUE)),na.rm=TRUE)
    hiiSD = sd(unlist(extract(mapaHII,est_i,na.rm=TRUE)),na.rm=TRUE)

    tabRes = rbind(tabRes,data.frame(estado = vetorEst[i],riqMed=riqMed,riqSD=riqSD,riscMed=riscMed,riscSD=riscSD,hiiMed=hiiMed,hiiSD=hiiSD))
    
}

tabRes = tabRes[!tabRes$estado=='DISTRITO FEDERAL',] #retirar o DF
tabRes = tabRes[order(tabRes$estado),] #ordem alfabetica 

tabBarb = read.csv("/home/anderson/Documentos/Projetos/Vetor x IDH para Doenca de Chagas/Incidencia media anual casos agudos 2000-2013.csv",header=TRUE)
tabBarb = tabBarb[order(tabBarb$UF),]

tabRes$NumCasos = c(tabBarb$NumCasos[1:10],NA,tabBarb$NumCasos[11:13],NA,tabBarb$NumCasos[14:24])
tabRes$MediaAno = c(tabBarb$MediaAno[1:10],NA,tabBarb$MediaAno[11:13],NA,tabBarb$MediaAno[14:24])
tabRes$Incidencia = c(tabBarb$Incidencia[1:10],NA,tabBarb$Incidencia[11:13],NA,tabBarb$Incidencia[14:24])

##
modRiqNum = glm(NumCasos~riqMed,family='poisson',data=tabRes)
summary(modRiqNum)
plot(tabRes$NumCasos ~ tabRes$riqMed)
abline(modRiqNum,col='red')

modRiscNum = glm(NumCasos~riscMed,family='poisson',data=tabRes)
summary(modRiscNum)
plot(tabRes$NumCasos ~ tabRes$riscMed)
abline(modRiscNum,col='red')

##Impacto Humano - numero de casos
modHiiMeanNum = glm(NumCasos~hiiMed,family='poisson',data=tabRes)
summary(modHiiMeanNum)
plot(tabRes$NumCasos ~ tabRes$hiiMed)
abline(modHiiNum,col='red')

modHiiSDNum = glm(NumCasos~hiiSD,family='poisson',data=tabRes)
summary(modHiiSDNum)
plot(tabRes$NumCasos ~ tabRes$hiiSD)
abline(modHiiSDNum,col='red')

##Impacto Humano - inidencia
modHiiMeanIncid = glm(Incidencia~hiiMed,family='gaussian',data=tabRes)
summary(modHiiMeanIncid)
plot(tabRes$Incidencia ~ tabRes$hiiMed)
abline(modHiiMeanIncid,col='red')

modHiiSDIncid = glm(Incidencia~hiiSD,family='gaussian',data=tabRes)
summary(modHiiSDIncid)
plot(tabRes$NumCasos ~ tabRes$hiiSD)
abline(modHiiSDIncid,col='red')

##Impacto Humano - numero medio de casos por ano
modHiiMeanMedAno = glm(MediaAno~hiiMed,family='gaussian',data=tabRes)
summary(modHiiMeanIncid)
plot(tabRes$MediaAno ~ tabRes$hiiMed)
abline(modHiiMeanMedAno,col='red')

modHiiSDMedAno = glm(MediaAno~hiiSD,family='gaussian',data=tabRes)
summary(modHiiSDMedAno)
plot(tabRes$MediaAno ~ tabRes$hiiSD)
abline(modHiiSDMedAno,col='red')